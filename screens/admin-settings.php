<?php
/**
* Copyright (c) 2018-2021 David J Bullock
* Web Power and Light
*/

 if (! defined('ABSPATH') ) { die(); } global $wpdb; memberium_app()->m4ac_fuen6oxg('view_options'); $_GET['tab'] = isset($_GET['tab']) ? $_GET['tab'] : 'login'; $m4ac_vlxpzmv0b = get_option(MEMBERIUM_MEMBERSHIP_PAGES_SETTINGS, [] ); if ($_SERVER['REQUEST_METHOD'] == 'POST') { if (! wp_verify_nonce($_POST['memberium_options_nonce'], MEMBERIUM_MODULES_DIR) ) { wp_die('nonce error'); return; } if (isset($_POST['pages']) && is_array($_POST['pages']) ) { foreach ($_POST['pages'] as $m4ac_ukqvxo6ne7 => $m4ac_ihnr7cyv) { $m4ac_vlxpzmv0b[$m4ac_ukqvxo6ne7] = $m4ac_ihnr7cyv; } update_option(MEMBERIUM_MEMBERSHIP_PAGES_SETTINGS, $m4ac_vlxpzmv0b); } if (isset($_POST['tag_dropdown_filter']) ) { $m4ac_yqah5jzkgcdf = array_filter(explode(',', $_POST['tag_dropdown_filter']) ); foreach($m4ac_yqah5jzkgcdf as $m4ac_egl6dkai => $m4ac_y2mw1xc6rq) { $m4ac_yqah5jzkgcdf[$m4ac_egl6dkai] = trim($m4ac_y2mw1xc6rq); } $_POST['tag_dropdown_filter'] = strtolower(implode(',', $m4ac_yqah5jzkgcdf) ); unset($m4ac_yqah5jzkgcdf, $m4ac_egl6dkai, $m4ac_y2mw1xc6rq); } $m4ac_bsijd7zrx = [ 'last_login_field', 'login_automation', 'login_url', 'logout_automation', 'logout_tag', 'max_contact_age', 'maximum_login_ips', 'username_field', ]; foreach($m4ac_bsijd7zrx as $m4ac_egl6dkai) { if (isset($_POST[$m4ac_egl6dkai]) ) { memberium_app()->m4ac_vlpfetc4son5($_POST[$m4ac_egl6dkai], trim($m4ac_egl6dkai) ); } }  $m4ac_bsijd7zrx = [ 'default_page_redirect', 'default_prohibited_action', 'displayname_format', 'global_excerpt', 'include_default_excerpt', 'last_login_field', 'loginlog_whitelist', 'password_field', 'registration_url', 'tag_dropdown_filter', 'thrivecart_secret', ]; foreach($m4ac_bsijd7zrx as $m4ac_egl6dkai) { if (isset($_POST[$m4ac_egl6dkai]) ) { memberium_app()->m4ac_vlpfetc4son5(trim($_POST[$m4ac_egl6dkai]), $m4ac_egl6dkai); } }  $m4ac_bsijd7zrx = [ 'allow_wpadmin_role', 'titlebar_role', 'wpadmin_role', ]; foreach($m4ac_bsijd7zrx as $m4ac_egl6dkai) { if (isset($_POST[$m4ac_egl6dkai]) ) { memberium_app()->m4ac_vlpfetc4son5(implode(',', $_POST[$m4ac_egl6dkai]), $m4ac_egl6dkai); } }  $m4ac_bsijd7zrx = [ 'allow_autologin', 'allow_local_logins', 'allow_wpadmin', 'autogenerate_excerpts', 'autoupdate', 'beta_update_check', 'cache_flush', 'contact_history', 'db_sessions', 'disable_displayname_update', 'disable_login_sync', 'disable_lost_password', 'disable_password_reset', 'disable_xframe', 'dynamic_menus', 'enable_ac_tracking', 'event_log_webhooks', 'fast_user_list', 'known_logins_only', 'local_auth_only', 'login_log', 'microcache_compat_session', 'page_inheritance', 'protect_feeds', 'require_membership', 'site_lock_enabled', 'sync_meta_updates', 'sync_new_users', 'two_pass_shortcodes', 'wp_welcome_email', ]; foreach($m4ac_bsijd7zrx as $m4ac_egl6dkai) { if (isset($_POST[$m4ac_egl6dkai]) ) { memberium_app()->m4ac_vlpfetc4son5( (int) (bool) $_POST[$m4ac_egl6dkai], $m4ac_egl6dkai); } }  $m4ac_bsijd7zrx = [ 'autologout_time', 'default_reglink_tag', 'excerpt_length', 'gdpr_deleted_tag', 'maximum_login_ips', 'maximum_login_timeframe', 'min_password_length', 'new_user_automation', 'new_user_registration_tag', 'password_reset_automation', 'secure_password_sync', 'secure_sync_automation', 'session_timeout', 'simultaneous_logins', 'site_ban_tag', 'user_deleted_tag', 'wp_autop', 'wplogin_redirect_to',  ]; foreach($m4ac_bsijd7zrx as $m4ac_egl6dkai) { if (isset($_POST[$m4ac_egl6dkai]) ) { memberium_app()->m4ac_vlpfetc4son5( (int) $_POST[$m4ac_egl6dkai], $m4ac_egl6dkai); } } if (isset($_POST['http_post_key']) ) { $m4ac_hx_1fcuq0 = preg_replace("/[^,A-Za-z0-9 ]/", '', $_POST['http_post_key']); $m4ac_hx_1fcuq0 = array_map('trim', explode(',', $m4ac_hx_1fcuq0) ); $m4ac_vi3a9n2f = array_map('trim', explode(',', memberium_app()->m4ac_x280qrz9kmic('autologin_authkeys') )); $m4ac_jrevf8wo2k7 = false; foreach ($m4ac_hx_1fcuq0 as $m4ac_lj_fwoc5ub1y => $m4ac_bzqua71m) { foreach ($m4ac_vi3a9n2f as $m4ac_lzwv76pb9) { if (strcasecmp($m4ac_bzqua71m, $m4ac_lzwv76pb9) === 0) { unset($m4ac_hx_1fcuq0[$m4ac_lj_fwoc5ub1y]); } } } memberium_app()->m4ac_vlpfetc4son5( trim( implode( ',', array_unique($m4ac_hx_1fcuq0) ), ','), 'http_post_key'); } if (isset($_POST['autologin_authkeys']) ) { $m4ac_vi3a9n2f = preg_replace("/[^,A-Za-z0-9 ]/", '', $_POST['autologin_authkeys']); $m4ac_vi3a9n2f = array_map('trim', explode(',', $m4ac_vi3a9n2f) ); $m4ac_hx_1fcuq0 = array_map('trim', explode(',', memberium_app()->m4ac_x280qrz9kmic('http_post_key') )); $m4ac_jrevf8wo2k7 = false; foreach ($m4ac_vi3a9n2f as $m4ac_lj_fwoc5ub1y => $m4ac_bzqua71m) { foreach ($m4ac_hx_1fcuq0 as $m4ac_lzwv76pb9) { if (strcasecmp($m4ac_bzqua71m, $m4ac_lzwv76pb9) === 0) { unset($m4ac_vi3a9n2f[$m4ac_lj_fwoc5ub1y]); } } } memberium_app()->m4ac_vlpfetc4son5( trim( implode( ',', array_unique($m4ac_vi3a9n2f) ), ',' ), 'autologin_authkeys' ); } if (isset($_POST['page_load']) ) { if ($_POST['page_load'] == 'Load All Templates') { $m4ac_qun8vk6d2 = $this->m4ac_sp1x89tb2(); foreach ($m4ac_qun8vk6d2 as $m4ac_tklg436xv => $m4ac_yebad2t8wi_) { $this->m4ac_g3se64yahpv(0, $m4ac_tklg436xv); } } elseif ($_POST['page_load'] == 'Load Single Template') { $this->m4ac_g3se64yahpv($_POST['target_post_id'], ($_POST['template_id'] - 1) ); } elseif ($_POST['page_load'] == 'Install Email Templates') { $email_templates_added = $this->m4ac_v1c7egvu3z(); } } if (isset($_POST['new_password_field']) ) { $_POST['new_password_field'] = trim($_POST['new_password_field']); $this->m4ac_w_e5l8puqad($_POST['new_password_field']); } if (isset($_GET['tab']) ) { if ($_GET['tab'] == 'general') { } elseif ($_GET['tab'] == 'updates') { $this->m4ac_g3ne76s9bjm('Updates Options Updated'); if ($_POST['manual_upgrade_confirm'] == 1) { $this->m4ac_ovo9zsk5mhqw($_POST['manual_upgrade']); } } elseif ($_GET['tab'] == 'webhooks') { $_POST['autologin_authkeys'] = trim(implode(',', $m4ac_vi3a9n2f), ','); $this->m4ac_g3ne76s9bjm('Options Updated'); if ($m4ac_jrevf8wo2k7) { $this->m4ac_g3ne76s9bjm('You cannot re-use Webhook Keys as Autologin Keys for security reasons' . m4ac_s126v0fexga::m4ac_e_rxkt9u(0000) ); } else { memberium_app()->m4ac_vlpfetc4son5($_POST['autologin_authkeys'], 'autologin_authkeys'); } unset($m4ac_ukqvxo6ne7, $m4ac_lzwv76pb9, $m4ac_jrevf8wo2k7, $m4ac_hx_1fcuq0, $m4ac_vi3a9n2f); $this->m4ac_g3ne76s9bjm('Webhook Options Updated'); } elseif ($_GET['tab'] == 'extensions') { $m4ac_xf28u9sh03ev = memberium_app()->m4ac_v0i3b6vafc(); foreach ($m4ac_xf28u9sh03ev as $m4ac_ukqvxo6ne7 => $m4ac_ihnr7cyv) { $m4ac_ukqvxo6ne7 = "ext/{$m4ac_ukqvxo6ne7}/enabled"; $m4ac_vc46bk_q = (int) (bool) $_POST[$m4ac_ukqvxo6ne7]; memberium_app()->m4ac_vlpfetc4son5((int)$m4ac_vc46bk_q, $m4ac_ukqvxo6ne7); } } } $m4ac_mjegm_n97rv = memberium_app()->m4ac_x280qrz9kmic('contact_history'); if (empty($m4ac_mjegm_n97rv) ) { $m4ac_jouqjei9gbc3 = MEMBERIUM_DB_CONTACTS; $m4ac_h57xqitcp = memberium_app()->m4ac_bztk3xj1(); $m4ac_xtcz6bi97flk = "DELETE FROM `{$m4ac_jouqjei9gbc3}` WHERE `appname` = %s AND `fieldname` = 'record'"; $m4ac_xtcz6bi97flk = $wpdb->prepare($m4ac_xtcz6bi97flk, $m4ac_h57xqitcp); $wpdb->query($m4ac_xtcz6bi97flk); } } $this->m4ac_eyfki_0es(); $m4ac_i8a6nj1oc5hl = [ 'login' => '<i class="fa fa-users"></i> Login', 'content' => '<i class="fa fa-file"></i> Content Protection',  'security2' => '<i class="fa fa-shield"></i> Site Security', 'pageproc' => '<i class="fa fa-unlock-alt"></i> Page Handling', 'performance' => '<i class="fa fa-rocket"></i> Performance',  'extensions' => '<i class="fa fa-plug"></i> Extensions', 'webhooks' => '<i class="fa fa-exchange"></i> Web Hooks/Links', ]; echo '<div class="wrap">'; echo '<h1>', _('Memberium Options'), '</h1>'; $m4ac_rlcs0yj3fk1 = $this->m4ac_d8yqavu9w($m4ac_i8a6nj1oc5hl); echo '<div class="tabcontent" style="margin-top:10px;">'; $m4ac_vj7al2oxz = MEMBERIUM_SCREEN_DIR . "admin-settings-{$m4ac_rlcs0yj3fk1}-show.php"; if (file_exists($m4ac_vj7al2oxz) ) { include_once $m4ac_vj7al2oxz; } echo '</div>'; echo '</div>'; $this->m4ac_iy1htpsfj();
