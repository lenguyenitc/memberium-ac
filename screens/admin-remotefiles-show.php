<?php
/**
 * Copyright (c) 2012-2021 David J Bullock
 * Web Power and Light
 */

 if (! defined('ABSPATH') ) { die(); }  global $wpdb; $m4ac_d3bwc5k09p6 = get_option('memberium_remote_files', [] ); if ($_SERVER['REQUEST_METHOD'] == 'POST') { if (isset($_POST['delete']) ) { foreach ($_POST['delete'] as $m4ac_qqy1ds2vl => $m4ac_vykuqfwdj_0) { if ($m4ac_vykuqfwdj_0 == 'on') { unset($m4ac_d3bwc5k09p6[$m4ac_qqy1ds2vl]); $this->m4ac_g3ne76s9bjm('Remote Storage Profile Deleted', 'error'); } } } if (isset($_POST['add-profile']) && trim($_POST['profile_name']) > '') { $m4ac_qqy1ds2vl = strtolower(trim($_POST['profile_name']) ); $m4ac_b2vqnhrwbma = []; $m4ac_b2vqnhrwbma['name'] = trim($_POST['profile_name']); $m4ac_b2vqnhrwbma['type'] = 's3'; $m4ac_b2vqnhrwbma['access_key'] = trim($_POST['s3_access_key']); $m4ac_b2vqnhrwbma['expiration'] = ( (int)$_POST['expiration'] > 0) ? (int) $_POST['expiration'] : 300; $m4ac_b2vqnhrwbma['secret_key'] = trim($_POST['s3_secret_key']); $m4ac_b2vqnhrwbma['host'] = (trim($_POST['default_host']) > '') ? trim($_POST['default_host']) : 's3.amazonaws.com'; $m4ac_b2vqnhrwbma['bucket'] = trim($_POST['default_bucket']); $m4ac_b2vqnhrwbma['region'] = trim($_POST['region']); $m4ac_d3bwc5k09p6[$m4ac_qqy1ds2vl] = $m4ac_b2vqnhrwbma; } update_option('memberium_remote_files', $m4ac_d3bwc5k09p6); } $m4ac__f_l4r6sh = count($m4ac_d3bwc5k09p6); $this->m4ac_eyfki_0es(); echo '<h1>Memberium Remote Files</h1>'; echo '<h3>Current Remote Storage Profiles', m4ac_s126v0fexga::m4ac_e_rxkt9u(2578), '</h3>'; echo '<div class="wrap">'; echo '<hr />'; echo '<form method="POST" action="" autocomplete="off">'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr>'; echo '<th nowrap="nowrap">Profile Name</th>'; echo '<th nowrap="nowrap">Default Host</th>'; echo '<th nowrap="nowrap">Default Bucket</th>'; echo '<th nowrap="nowrap">Region</th>'; echo '<th nowrap="nowrap">S3 Access Key</th>'; echo '<th nowrap="nowrap">S3 Secret Key</th>'; echo '<th nowrap="nowrap">Expiration</th>'; echo '<th>Delete?</th>'; echo '</tr>'; if ($m4ac__f_l4r6sh == 0) { echo '<tr><td colspan="99">You have no remote storage defined.</td></tr>'; } else { foreach ($m4ac_d3bwc5k09p6 as $m4ac_h7_6lgxef => $m4ac_mcgw3_2ib8u) { if ($m4ac_mcgw3_2ib8u['type'] == 's3') { echo '<tr>'; echo '<td>', $m4ac_mcgw3_2ib8u['name'], '</td>'; echo '<td>', $m4ac_mcgw3_2ib8u['host'], '</td>'; echo '<td>', $m4ac_mcgw3_2ib8u['bucket'], '</td>'; echo '<td>', isset($m4ac_mcgw3_2ib8u['region']) ? $m4ac_mcgw3_2ib8u['region'] : 'Default', '</td>'; echo '<td>', $m4ac_mcgw3_2ib8u['access_key'], '</td>'; echo '<td>', substr($m4ac_mcgw3_2ib8u['secret_key'], 0, 8), '********</td>'; echo '<td>', (int)$m4ac_mcgw3_2ib8u['expiration'], '</td>'; echo '<td>'; echo '<input type="checkbox" name="delete[' . $m4ac_h7_6lgxef . ']">'; echo '</td>'; echo '</tr>'; } } } echo '</table>'; echo '&nbsp;<br />'; if ($m4ac__f_l4r6sh > 0) { echo '<input type="submit" name="delete-profiles" value="Delete Profiles" class="button-secondary" />'; } echo '</form>'; echo '</div>'; echo '<h3>Add New Remote Storage Profile</h3>'; echo '<div style="width:800px;">'; echo '<form method="POST" action="">'; echo '<table class="widefat">'; echo '<input type="hidden" name="type" value="s3">'; echo '<tr>'; echo '<th nowrap="nowrap">Profile Name</th>'; echo '<th nowrap="nowrap">Profile Type</th>'; echo '<th nowrap="nowrap">Default Host</th>'; echo '<th nowrap="nowrap">Default Bucket</th>'; echo '<th nowrap="nowrap">S3 Region</th>'; echo '<th nowrap="nowrap">S3 Access Key</th>'; echo '<th nowrap="nowrap">S3 Secret Key</th>'; echo '<th nowrap="nowrap">Expiration</th>'; echo '</tr>'; echo '<tr>'; echo '<td><input name="profile_name" type="text" size="10" autocomplete="off"/></td>'; echo '<td><select name="profile_type"><option value="s3">Amazon S3</option></select></td>'; echo '<td><input name="default_host" type="text" size="20" placeholder="s3.amazonaws.com" autocomplete="off"/></td>'; echo '<td><input name="default_bucket" type="text" size="20" autocomplete="off"/></td>'; $m4ac_os_febglr685 = m4ac_p58mfx3cua::m4ac_h3thn_l7g(); echo '<td><select name="region"/>'; foreach($m4ac_os_febglr685 as $m4ac_egl6dkai => $m4ac_y2mw1xc6rq) { echo "<option value='{$m4ac_y2mw1xc6rq}' ".($m4ac_y2mw1xc6rq == 'us-east-1' ? ' selected ' : '') . ">{$m4ac_egl6dkai}</option>"; } echo '</select></td>'; echo '<td><input name="s3_access_key" type="text" size="20" autocomplete="off"/></td>'; echo '<td><input name="s3_secret_key" type="text" size="20" autocomplete="off"/></td>'; echo '<td><input name="expiration" type="text" size="4" autocomplete="off"/></td>'; echo '</tr>'; echo '</table>'; echo '&nbsp;<br />'; echo '<input type="submit" name="add-profile" value="Add Remote Profile" class="button-primary" />'; echo '<hr />'; echo '</form>'; echo '</div>';
