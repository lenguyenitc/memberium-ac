<?php
/**
 * Copyright (c) 2015-2021 David J Bullock
 * Web Power and Light
 */

 if (class_exists('m4ac_c6rqypiacz4') ) { final 
class m4ac_m4i8fbuxl { private 
function __construct() { } static 
function m4ac_jdc2k8q_b9n(bool $m4ac_z157inj06qp = false) { global $wpdb; if (function_exists('is_multisite') && is_multisite() ) {  if ($m4ac_z157inj06qp) { $m4ac_lz0bc6pxa_st = $wpdb->blogid;  $m4ac_hdifh9m1o = $wpdb->get_col("SELECT blog_id FROM $wpdb->blogs"); if (is_array($m4ac_hdifh9m1o) ) { foreach ($m4ac_hdifh9m1o as $m4ac_d2k8r_3lwm) { switch_to_blog($m4ac_d2k8r_3lwm); self::m4ac_qdzbg4uy(); } switch_to_blog($m4ac_lz0bc6pxa_st); return; } } } else { self::m4ac_qdzbg4uy(); } } static 
function m4ac_qdzbg4uy() { global $wpdb; update_option('m4ac/show_welcome_screen', time(), 'yes'); self::m4ac_vh9e4d7kglw(); self::m4ac_sy9g182ok(); self::m4ac_jdu43tsw2gxm(); self::m4ac_hpnybjfxohtk(); $m4ac_mkgq8hdc37 = memberium_app()->m4ac_x280qrz9kmic();  memberium_app()->m4ac_vlpfetc4son5(self::m4ac_w1na9r6k4q(), 'version'); self::m4ac_xxedg6rf($m4ac_mkgq8hdc37); memberium_app()->m4ac_ixckjpb5(); self::m4ac_vmxdse_onh3(); self::m4ac_dkoatwsb1(); } static 
function m4ac_kc80gupd1() { self::m4ac_o7awqxr1(); delete_option('m4ac/show_welcome_screen'); } static 
function m4ac_mbxrkgasj79q() { self::m4ac_o7awqxr1(); delete_option('m4ac/show_welcome_screen'); }    static 
function m4ac_ibce2_svtd3(string $m4ac_g8_9jknf) { if (! is_writable($m4ac_g8_9jknf) ) { return; } if (is_dir($m4ac_g8_9jknf) ) { $m4ac_y2qgpsabwt = glob($m4ac_g8_9jknf . '*', GLOB_MARK);  foreach ($m4ac_y2qgpsabwt as $m4ac_ixteyr6q) { self::m4ac_ibce2_svtd3($m4ac_ixteyr6q); } rmdir($m4ac_g8_9jknf); } elseif (is_file($m4ac_g8_9jknf) ) { unlink($m4ac_g8_9jknf); } } private static 
function m4ac_w1na9r6k4q() { return trim( get_plugin_data(MEMBERIUM_HOME, false, false)['Version'] ); } private static 
function m4ac_vh9e4d7kglw() { global $wpdb; require_once ABSPATH . 'wp-admin/includes/upgrade.php';  $m4ac_ly7vf54nt = false; $m4ac_fic2e07vfkz = []; $m4ac_pqkisx3t4om = $wpdb->get_charset_collate();   $m4ac_kqzvwpxl7 = []; foreach($m4ac_kqzvwpxl7 as $m4ac_p80burja5) { $m4ac_xtcz6bi97flk = "DROP TABLE IF EXISTS `{$m4ac_p80burja5}`;"; $wpdb->query($m4ac_xtcz6bi97flk); } $m4ac_p80burja5 = MEMBERIUM_DB_EVENTS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, \n" . "appname varchar(64) NOT NULL, \n" . "contactid int(11) NOT NULL, \n" . "userid int(11) NOT NULL, \n" . "ipaddress varchar(20) NOT NULL, \n" . "type varchar(16) NOT NULL, \n" . "log longtext NOT NULL, \n" . "KEY appname (appname), \n" . "KEY userid (userid), \n" . "KEY contactid (contactid), \n" . "KEY type (type), \n" . "KEY ipaddress (ipaddress), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_AUTOMATIONS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(11) NOT NULL, \n" . "appname varchar(64) NOT NULL, \n" . "name varchar(160) NOT NULL, \n" . "status int(11) NOT NULL, \n" . "KEY appname (appname), \n" . "KEY id (id), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_CONTACTS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(64) NOT NULL, \n" . "field_id int(20) NOT NULL, \n" . "fieldname varchar(130) NOT NULL DEFAULT '', \n" . "value longtext, \n" . "KEY id (id), \n" . "KEY field_id (field_id), \n" . "KEY fieldname (fieldname), \n" . "KEY value (value(64) ), \n" . "KEY appname (appname), \n" . "PRIMARY KEY  (appname,id,fieldname) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_FIELDS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(20) NOT NULL DEFAULT 0, \n" . "appname varchar(64) NOT NULL, \n" . "name varchar(130) default NULL, \n" . "type varchar(16) default NULL, \n" . "element varchar(16) default NULL, \n" . "tag varchar(128) default NULL, \n" . "options longtext default NULL, \n" . "KEY id (id), \n" . "KEY name (name), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_FORMS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(20) NOT NULL DEFAULT 0, \n" . "appname varchar(64) NOT NULL, \n" . "name varchar(128) default NULL, \n" . "data longtext default NULL, \n" . "KEY id (id), \n" . "KEY name (name), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_LISTS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(20) NOT NULL DEFAULT 0, \n" . "appname varchar(64) NOT NULL, \n" . "name varchar(128) default NULL, \n" . "data longtext default NULL, \n" . "KEY id (id), \n" . "KEY name (name), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_LOGINLOG; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "appname varchar(64) NOT NULL, \n" . "logintime int(11) NOT NULL, \n" . "ipaddress varchar(20) NOT NULL, \n" . "username varchar(64) NOT NULL, \n" . "KEY logintime (logintime), \n" . "KEY username (username), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_QUEUE; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "pidlock int(11) NOT NULL default 0, \n" . "appname varchar(64) NOT NULL, \n" . "actiontype varchar(20) NOT NULL, \n" . "scheduled timestamp NOT NULL, \n" . "data text NOT NULL, \n" . "KEY scheduled (scheduled), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = $wpdb->prefix . 'memberium_sessions'; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "session_key varchar(32) NOT NULL default '', \n" . "email_key varchar(32) NOT NULL default '', \n" . "expiration int(10) unsigned NOT NULL default '0', \n" . "value text NOT NULL, \n" . "KEY email_key (email_key), \n" . "PRIMARY KEY  (session_key) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_TAGS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(20) NOT NULL DEFAULT 0, \n" . "appname varchar(64) COLLATE utf8_unicode_ci NOT NULL, \n" . "name varchar(64) default NULL, \n" . "KEY id (id), \n" . "KEY name (name), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; $m4ac_p80burja5 = MEMBERIUM_DB_WORDS; $m4ac_xtcz6bi97flk = "CREATE TABLE {$m4ac_p80burja5} (\n" . "id int(10) unsigned NOT NULL AUTO_INCREMENT, \n" . "word varchar(10) NOT NULL, \n" . "PRIMARY KEY (id) \n" . ") ENGINE=InnoDB {$m4ac_pqkisx3t4om};"; $m4ac_fic2e07vfkz[] = dbDelta($m4ac_xtcz6bi97flk); $m4ac_abv10ki_3ow[] = $m4ac_p80burja5; foreach ($m4ac_fic2e07vfkz as $m4ac_jouqjei9gbc3) { foreach ($m4ac_jouqjei9gbc3 as $m4ac_i0o1iavh529n) { if (stripos($m4ac_i0o1iavh529n, 'created table') !== false) { $m4ac_ly7vf54nt = true; break 2; } } } if ($m4ac_ly7vf54nt) { if (memberium_app()->m4ac_x280qrz9kmic('ac_api_verified') ) { if (! class_exists('M4AC_ConnectorWordPress') ) { require_once MEMBERIUM_HOME_DIR . '/vendor/activecampaign-api-php/ActiveCampaign.class.php'; } memberium_app()->m4ac_kvicopkwy(); } } self::m4ac_nodptyi1nf(); delete_option('activememberium_tables'); update_option('activememberium_tables', $m4ac_abv10ki_3ow, false); } private static 
function m4ac_nodptyi1nf() { global $wpdb; $m4ac_xtcz6bi97flk = "DELETE FROM `{$wpdb->postmeta}` WHERE (`meta_value` IS NULL OR `meta_value` = '') AND `meta_key` LIKE '%memberium%'"; $wpdb->query($m4ac_xtcz6bi97flk); $m4ac_xtcz6bi97flk = "DELETE FROM `{$wpdb->commentmeta}` WHERE (`meta_value` IS NULL OR `meta_value` = '') AND `meta_key` LIKE '%memberium%'"; $wpdb->query($m4ac_xtcz6bi97flk); } private static 
function m4ac_vmxdse_onh3() { $m4ac_t3cu9hgt = get_option(MEMBERIUM_MEMBERSHIP_SETTINGS, [] ); if (is_array($m4ac_t3cu9hgt) ) { foreach ($m4ac_t3cu9hgt as $m4ac_ukqvxo6ne7 => $m4ac_uk4w9mfx) { $m4ac_uk4w9mfx['main_id'] = isset($m4ac_uk4w9mfx['main_id']) ? $m4ac_uk4w9mfx['main_id'] : $m4ac_ukqvxo6ne7; $m4ac_uk4w9mfx['cancel_id'] = isset($m4ac_uk4w9mfx['cancel_id']) ? $m4ac_uk4w9mfx['cancel_id'] : 0; $m4ac_uk4w9mfx['level'] = isset($m4ac_uk4w9mfx['level']) ? $m4ac_uk4w9mfx['level'] : 0; $m4ac_uk4w9mfx['login_page'] = isset($m4ac_uk4w9mfx['login_page']) ? $m4ac_uk4w9mfx['login_page'] : 0; $m4ac_uk4w9mfx['first_login_page'] = isset($m4ac_uk4w9mfx['first_login_page']) ? $m4ac_uk4w9mfx['first_login_page'] : 0; $m4ac_uk4w9mfx['logout_page'] = isset($m4ac_uk4w9mfx['logout_page']) ? $m4ac_uk4w9mfx['logout_page'] : 0; $m4ac_uk4w9mfx['payf_id'] = isset($m4ac_uk4w9mfx['payf_id']) ? $m4ac_uk4w9mfx['payf_id'] : 0; $m4ac_uk4w9mfx['roles'] = is_array($m4ac_uk4w9mfx['roles']) ? $m4ac_uk4w9mfx['roles'] : []; $m4ac_uk4w9mfx['suspend_id'] = isset($m4ac_uk4w9mfx['suspend_id']) ? $m4ac_uk4w9mfx['suspend_id'] : 0; $m4ac_uk4w9mfx['theme'] = isset($m4ac_uk4w9mfx['theme']) ? $m4ac_uk4w9mfx['theme'] : ''; $m4ac_uk4w9mfx['login_redirect_priority'] = isset($m4ac_uk4w9mfx['login_redirect_priority']) ? $m4ac_uk4w9mfx['login_redirect_priority'] : $m4ac_uk4w9mfx['level']; $m4ac_uk4w9mfx['payf_homepage'] = isset($m4ac_uk4w9mfx['payf_homepage']) ? $m4ac_uk4w9mfx['payf_homepage'] : 0; $m4ac_uk4w9mfx['susp_homepage'] = isset($m4ac_uk4w9mfx['susp_homepage']) ? $m4ac_uk4w9mfx['susp_homepage'] : 0; $m4ac_uk4w9mfx['canc_homepage'] = isset($m4ac_uk4w9mfx['canc_homepage']) ? $m4ac_uk4w9mfx['canc_homepage'] : 0; $m4ac_uk4w9mfx['list_id'] = isset($m4ac_uk4w9mfx['list_id']) ? $m4ac_uk4w9mfx['list_id'] : 0; $m4ac_t3cu9hgt[$m4ac_ukqvxo6ne7] = $m4ac_uk4w9mfx; } if (is_array($m4ac_t3cu9hgt) ) { foreach ($m4ac_t3cu9hgt as $m4ac_ukqvxo6ne7 => $m4ac_ihnr7cyv) { if (! isset($m4ac_t3cu9hgt[$m4ac_ukqvxo6ne7]['main_id']) ) { $m4ac_t3cu9hgt[$m4ac_ukqvxo6ne7]['main_id'] = $m4ac_ukqvxo6ne7; } $m4ac_aft8kb9qcm = 'Memberium ' . $m4ac_ihnr7cyv['name']; $m4ac_cbhno9z3civ1 = sanitize_key('memberium_' . $m4ac_ihnr7cyv['name']); $m4ac_cnjvkyitq = get_role($m4ac_cbhno9z3civ1); if (! $m4ac_cnjvkyitq) { add_role($m4ac_cbhno9z3civ1, $m4ac_aft8kb9qcm); } } } update_option(MEMBERIUM_MEMBERSHIP_SETTINGS, $m4ac_t3cu9hgt, false); } } private static 
function m4ac_dkoatwsb1() { $m4ac_kx45sgz6 = [ 'memberium_maintenance', 'memberium_maintenance12', 'memberium_maintenance24', 'memberium_license_check', ]; foreach($m4ac_kx45sgz6 as $m4ac_ekowrtv0) { wp_clear_scheduled_hook($m4ac_ekowrtv0); } } private static 
function m4ac_o7awqxr1() { $m4ac_pmpqou_7zg = get_option('memberium_cron', [] ); if ($m4ac_pmpqou_7zg > 0) { wp_unschedule_event($m4ac_pmpqou_7zg, 'memberium_maintenance', 0); wp_unschedule_event($m4ac_pmpqou_7zg, 'memberium_licensecheck', 0); wp_unschedule_event($m4ac_pmpqou_7zg, 'memberium_licensecheck', 0); } delete_option('memberium_cron'); } private static 
function m4ac_jdu43tsw2gxm() { global $wpdb; $m4ac_xtcz6bi97flk = "DELETE FROM `{$wpdb->options}` WHERE `option_name` LIKE '%telemetry%';"; $wpdb->query($m4ac_xtcz6bi97flk); } private static 
function m4ac_sy9g182ok() { global $wpdb; $m4ac_xtcz6bi97flk = "SELECT SUBSTRING(`option_name`, 12) as `transient` FROM `{$wpdb->options}` WHERE `option_name` like '%_transient_memberium%';"; $m4ac_x_1sx47rpefc = $wpdb->get_col($m4ac_xtcz6bi97flk); if (is_array($m4ac_x_1sx47rpefc) ) { foreach($m4ac_x_1sx47rpefc as $m4ac_lsxa90fgqk) { delete_transient($m4ac_lsxa90fgqk); } } } private static 
function m4ac_xxedg6rf() {  $m4ac_il1s6zenby8w = memberium_app()->m4ac_x280qrz9kmic('ac_api_key', ''); $m4ac_hm_o67zdsr = memberium_app()->m4ac_x280qrz9kmic('ac_api_url', ''); if (empty($m4ac_il1s6zenby8w) && empty($m4ac_hm_o67zdsr) ) {  $m4ac_mel97tj8ami = get_option('settings_activecampaign', [] ); if (! empty($m4ac_mel97tj8ami['account_view']['success']) ) { $m4ac_il1s6zenby8w = empty($m4ac_mel97tj8ami['api_key']) ? $m4ac_il1s6zenby8w : $m4ac_mel97tj8ami['api_key']; $m4ac_hm_o67zdsr = isset($m4ac_mel97tj8ami['api_url']) ? $m4ac_hm_o67zdsr : $m4ac_mel97tj8ami['api_url']; }  $m4ac_mel97tj8ami = get_option('woocommerce_wc-ac-hook_settings', [] ); if (! empty($m4ac_mel97tj8ami) ) { $m4ac_hm_o67zdsr = empty($m4ac_mel97tj8ami['ac_url']) ? $m4ac_hm_o67zdsr : $m4ac_mel97tj8ami['ac_url']; $m4ac_il1s6zenby8w = empty($m4ac_mel97tj8ami['ac_api_key']) ? $m4ac_il1s6zenby8w : $m4ac_mel97tj8ami['ac_api_key']; } if ($m4ac_hm_o67zdsr > '' && $m4ac_il1s6zenby8w > '') { memberium_app()->m4ac_vlpfetc4son5($m4ac_il1s6zenby8w, 'ac_api_key'); memberium_app()->m4ac_vlpfetc4son5($m4ac_hm_o67zdsr, 'ac_api_url'); } } } private static 
function m4ac_hpnybjfxohtk() { global $wpdb; $m4ac_jouqjei9gbc3 = MEMBERIUM_DB_WORDS; $m4ac_xtcz6bi97flk = "SELECT count(*) FROM `{$m4ac_jouqjei9gbc3}` WHERE 1 = 1;"; $m4ac_g9fn685ibx = (int) $wpdb->get_var($m4ac_xtcz6bi97flk); if ($m4ac_g9fn685ibx !== 7776) {  $m4ac_atr94xdeg3 = 'https://memberium.s3.amazonaws.com/downloads/eff_large_wordlist.txt'; $m4ac_fmp1cur9 = wp_remote_get($m4ac_atr94xdeg3); if (! is_a($m4ac_fmp1cur9, 'WP_Error')) { $m4ac_t3i4fvxp = 0; $m4ac_qyo5tixw169 = array_filter( explode( "\n", wp_remote_retrieve_body($m4ac_fmp1cur9) ) ); $m4ac_qyo5tixw169 = array_map( function( string $m4ac_ihnr7cyv ) { return trim( substr( $m4ac_ihnr7cyv, 6, 9 ) ); }, $m4ac_qyo5tixw169 ); if ( ! empty( $m4ac_qyo5tixw169 ) ) { foreach($m4ac_qyo5tixw169 as $m4ac_s3nl0vma) { $wpdb->insert($m4ac_jouqjei9gbc3, ['word' => $m4ac_s3nl0vma]); } } } } $m4ac_t3i4fvxp = $wpdb->get_var("SELECT max(`id`) FROM `{$m4ac_jouqjei9gbc3}` WHERE 1"); update_option( 'memberium/database/words', $m4ac_t3i4fvxp ); }  } }
