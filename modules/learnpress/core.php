<?php
/**
 * Copyright (c) 2012-2021 David J Bullock
 * Web Power and Light
 */

 if (class_exists('m4ac_c6rqypiacz4') ) { final 
class m4ac__w0jv6robn2 { 
function m4ac_wbqh0d1a69fr($m4ac_qz2fsdy3pb) { $m4ac_qz2fsdy3pb[] = 'lp_order'; return $m4ac_qz2fsdy3pb; } 
function m4ac_oc6oh9k3s($m4ac_e5of6g9an_, $m4ac_at_5xofh, $m4ac_eq46hibd07c) { $m4ac_nqhkb0w7 = trim(get_post_meta($m4ac_eq46hibd07c, '_memberium_lms_autoenroll', true), ','); if (! empty($m4ac_nqhkb0w7) ) { $m4ac__crsbi5yuze = (isset($_SESSION['memb_user']['id']) && $m4ac_at_5xofh == $_SESSION['memb_user']['id']) ? $_SESSION : memberium_app()->m4ac_c17vlcx3a4($m4ac_at_5xofh); if (! empty($m4ac__crsbi5yuze['memb_db_fields']['tag_ids']) ) { $m4ac_e5of6g9an_ = memberium_app()->m4ac_t5ws0_v68($m4ac_nqhkb0w7, $m4ac__crsbi5yuze); } } return (bool) $m4ac_e5of6g9an_; } 
function m4ac_y3uqaxt0($m4ac_at_5xofh = 0, $m4ac__crsbi5yuze = false) { global $wpdb; static $autoenrolled = []; if (empty($m4ac_at_5xofh) ) { return; } if (empty($m4ac__crsbi5yuze['memb_db_fields']['tag_ids']) ) { return; } $m4ac_pmokvuh_i = $wpdb->posts; $m4ac_aekgzj_c1 = $wpdb->postmeta; $m4ac_xtcz6bi97flk = "SELECT ID, meta_value FROM {$m4ac_pmokvuh_i}, {$m4ac_aekgzj_c1} WHERE post_status = 'publish' AND post_type = 'lp_course' AND  post_id = ID AND meta_key = '_memberium_lms_autoenroll' AND meta_value > '' "; $m4ac_dwslpr0x57b = $wpdb->get_results($m4ac_xtcz6bi97flk, ARRAY_A); if (empty($m4ac_dwslpr0x57b) ) { return; } $m4ac_e_pjlmov5 = $this->m4ac_xek9o8vd57i($m4ac_at_5xofh); foreach ($m4ac_dwslpr0x57b as $m4ac_maz5nvkp) { $m4ac__37l6rhivt2 = $m4ac_maz5nvkp['ID']; $m4ac_jhx6btae = in_array($m4ac__37l6rhivt2, $m4ac_e_pjlmov5) || in_array($m4ac__37l6rhivt2, $autoenrolled); $m4ac_nqhkb0w7 = trim($m4ac_maz5nvkp['meta_value'], ','); $m4ac_ybq2g0h7 = []; if (! $m4ac_jhx6btae) { if (memberium_app()->m4ac_t5ws0_v68($m4ac_nqhkb0w7, $m4ac__crsbi5yuze) ) { $this->m4ac_pdq4bg1pu3ls($m4ac_at_5xofh, $m4ac__37l6rhivt2); $m4ac_ybq2g0h7[] = $m4ac__37l6rhivt2; } } } } 
function m4ac_bl192q_o($m4ac_eq46hibd07c, $m4ac_at_5xofh, $m4ac_l1hwqlx0u) { $m4ac_uo08x_g7 = (int) memberium_app()->m4ac_pm63av15g($m4ac_at_5xofh); if (! $m4ac_uo08x_g7 || ! $m4ac_at_5xofh) { return; } $m4ac_xurp0xnols83 = get_post_meta($m4ac_eq46hibd07c); if (! empty($m4ac_xurp0xnols83['_memberium_lms_automation'][0]) ) { memberium_app()->m4ac_lmhdiugb6cs($m4ac_xurp0xnols83['_memberium_lms_automation'][0], $m4ac_uo08x_g7); } if (! empty($m4ac_xurp0xnols83['_memberium_lms_tag'][0]) ) { memberium_app()->m4ac_ocsjt69hrb($m4ac_xurp0xnols83['_memberium_lms_tag'][0], $m4ac_uo08x_g7); } do_action('memberium/lms/completion', $m4ac_at_5xofh, $m4ac__37l6rhivt2); } 
function m4ac_btjc3dml($m4ac_dhfjw_ib, $m4ac_fic2e07vfkz, $m4ac_at_5xofh) { $m4ac_uo08x_g7 = (int) memberium_app()->m4ac_pm63av15g($m4ac_at_5xofh); if (! $m4ac_uo08x_g7 || ! $m4ac_at_5xofh) { return; } $m4ac_xurp0xnols83 = get_post_meta($m4ac_dhfjw_ib); if (! empty($m4ac_xurp0xnols83['_memberium_lms_automation'][0]) ) { memberium_app()->m4ac_lmhdiugb6cs($m4ac_xurp0xnols83['_memberium_lms_automation'][0], $m4ac_uo08x_g7); } if (! empty($m4ac_xurp0xnols83['_memberium_lms_tag'][0]) ) { memberium_app()->m4ac_ocsjt69hrb($m4ac_xurp0xnols83['_memberium_lms_tag'][0], $m4ac_uo08x_g7); } do_action('memberium/lms/completion', $m4ac_at_5xofh, $m4ac__37l6rhivt2); } 
function m4ac_qzhayeub1($m4ac_zr0lh_c46gkw, $m4ac_eq46hibd07c, $m4ac_at_5xofh) { $m4ac_uo08x_g7 = (int) memberium_app()->m4ac_pm63av15g($m4ac_at_5xofh); if (! $m4ac_uo08x_g7 || ! $m4ac_at_5xofh) { return; } $m4ac_bo6uv4knix = new LP_Abstract_User($m4ac_at_5xofh); $m4ac_l_4xcqjt = $m4ac_bo6uv4knix->get_quiz_results($m4ac_zr0lh_c46gkw, $m4ac_eq46hibd07c); $m4ac_ptayomc30p9 = ($m4ac_l_4xcqjt->_quiz_grade == 'passed'); $m4ac_wjuqlbwaz = $m4ac_l_4xcqjt->mark_percent; $m4ac_xurp0xnols83 = get_post_meta($m4ac_zr0lh_c46gkw); if ($m4ac_ptayomc30p9) { if (! empty($m4ac_xurp0xnols83['_memberium_lms_automation'][0]) ) { memberium_app()->m4ac_lmhdiugb6cs($m4ac_xurp0xnols83['_memberium_lms_automation'][0], $m4ac_uo08x_g7); } if (! empty($m4ac_xurp0xnols83['_memberium_lms_tag'][0]) ) { memberium_app()->m4ac_ocsjt69hrb($m4ac_xurp0xnols83['_memberium_lms_tag'][0], $m4ac_uo08x_g7); } do_action('memberium/lms/completion', $m4ac_at_5xofh, $m4ac__37l6rhivt2); } else {  } } 
function m4ac_xek9o8vd57i($m4ac_at_5xofh) { if (empty($m4ac_at_5xofh) ) { return []; } $m4ac_bo6uv4knix = new lp_user($m4ac_at_5xofh); $m4ac_iwmf25r3k4l = $m4ac_bo6uv4knix->get_orders(); $m4ac_qxw38z6ld = []; foreach($m4ac_iwmf25r3k4l as $m4ac_eq46hibd07c => $m4ac_macz7d15s0k3) { $m4ac_qxw38z6ld[] = $m4ac_eq46hibd07c; } return $m4ac_qxw38z6ld; } 
function m4ac_pdq4bg1pu3ls($m4ac_at_5xofh, $m4ac_eq46hibd07c) { if (empty($m4ac_eq46hibd07c) || empty($m4ac_at_5xofh) ) { return false; } $m4ac_bo6uv4knix = new lp_user($m4ac_at_5xofh); $m4ac__khy05gls_ = learn_press_create_order(null); $m4ac_macz7d15s0k3 = $m4ac__khy05gls_->get_id(); $m4ac__khy05gls_->set_user_id($m4ac_at_5xofh); $m4ac__khy05gls_->save(); learn_press_add_order_item($m4ac_macz7d15s0k3, $m4ac_eq46hibd07c); learn_press_update_order_status($m4ac_macz7d15s0k3, 'lp-completed');  return $m4ac_macz7d15s0k3; } private 
function m4ac_rh6ijntd() {  add_action('memberium/session/updated', [$this, 'm4ac_y3uqaxt0'], 10, 2); add_filter('memberium/unenhanced_posts', [$this, 'm4ac_wbqh0d1a69fr'], 10, 1);  add_action('learn-press/user-course-finished', [$this, 'm4ac_bl192q_o'], 10, 3);  add_action('learn-press/user-completed-lesson', [$this, 'm4ac_btjc3dml'], 10, 3);  add_action('learn-press/user/quiz-finished', [$this, 'm4ac_qzhayeub1'], 10, 3);  add_filter('learn-press/has-enrolled-course', [$this, 'm4ac_oc6oh9k3s'], PHP_INT_MAX, 3); } private 
function __construct() { memberium_app()->m4ac_chxl7ms_o9c('m4aclearnpress', 'LearnPress for Memberium for ActiveCampaign'); $this->m4ac_rh6ijntd(); if (is_admin() ) { include_once __DIR__ . '/admin.php'; m4ac_bs50znfu::m4ac_zw_dhmca(); } } static 
function m4ac_zw_dhmca() : self { static $m4ac_u4tpxcro19 = false; return $m4ac_u4tpxcro19 ? $m4ac_u4tpxcro19 : $m4ac_u4tpxcro19 = new self; }  } }
